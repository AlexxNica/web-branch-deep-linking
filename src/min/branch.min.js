/*! Branch Metrics Web SDK - branch-web-sdk: v0.1.6 - 2014-11-12 11:32:20 PST */
var branch_map={debugMessages:{nonInit:"Branch SDK not initialized",existingInit:"Branch SDK already initilized",missingParam:"Missing required parameter ",invalidParam:"Invalid parameter ",missingAppId:"Missing Branch app ID"},formap:{string:/.*/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,password:/.{6,}/,uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,appId:/^[0-9]{17}$/,identityId:/^[0-9]{17}$/,sessionId:/^[0-9]{17}$/,jsonObj:"object",number:/^d+$/},resources:{session:{sessionOpen:{endpoint:"/v1/open",method:"POST",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!1},link_identifier:{type:"string",required:!1},is_referrable:{type:"number",required:!0},browser_fingerprint_id:{type:"string",required:!1}}},sessionProfile:{endpoint:"/v1/profile",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!1},obj:{type:"jsonObj",required:!0,ref:"obj",params:{identity:{type:"string",required:!0},set:{type:"jsonObj",required:!1},add:{type:"jsonObj",required:!1},append:{type:"jsonObj",required:!1},union:{type:"jsonObj",required:!1}}}}},sessionClose:{endpoint:"/v1/close",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0}}},sessionLogout:{endpoint:"/v1/logout",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0}}}},referrals:{showReferrals:{endpoint:"/v1/referrals/:identity_id",method:"GET",rest:["identity_id"],params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0}}},showCredits:{endpoint:"/v1/credits/:identity_id",method:"GET",rest:["identity_id"],params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0}}},redeemCredits:{endpoint:"/v1/redeem",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0},obj:{type:"jsonObj",required:!0,ref:"obj",params:{amount:{type:"number",required:!0},bucket:{type:"string",required:!1}}}}}},links:{createLink:{endpoint:"/v1/url",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity:{type:"identityId",required:!0},obj:{type:"jsonObj",required:!0,ref:"obj",params:{data:{type:"jsonObj",required:!1},tags:{type:"jsonArray",required:!1},feature:{type:"string",required:!1},channel:{type:"string",required:!1},stage:{type:"string",required:!1},type:{type:"number",required:!1}}}}},createLinkClick:{api:!1,endpoint:":link_url",method:"GET",rest:["link_url"],params:{link_url:{type:"string",required:!0}}},sendSMSLink:{api:!1,endpoint:":link_url",method:"POST",rest:["link_url"],params:{phone:{type:"string",required:!0},link_url:{type:"string",required:!0}}}},events:{track:{endpoint:"/v1/event",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0},event:{type:"string",required:!0},metadata:{type:"jsonObj",required:!1}}}}}},Branch=function(a,b){"use strict";this.initialized=!1,this.api={},this.utils={},this.utils.console=function(a){return b&&console.error(a),!1},this.utils.readSession=function(){return JSON.parse(sessionStorage.getItem("branch_session"))},this.utils.identity=function(){var a="";return sessionStorage.getItem("branch_session")&&(a=this.readSession().identity_id),a},this.utils.session=function(){var a="";return sessionStorage.getItem("branch_session")&&(a=this.readSession().session_id),a},this.utils.mergeMeta=function(a,b){var c={};for(var d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c},this.utils.hashValue=function(a){var b;try{b=location.hash.match(new RegExp(a+":([^&]*)"))[1]}catch(c){b=void 0}return b},this.utils.queue=function(){var a=this;a.free=!0,a.chain=[],a.next=function(){a.chain.length>0?(a.free=!0,a.chain[0].call(),a.chain.shift()):a.free=!0},a.route=function(b,c){a.free?(b(),a.free=!1):c()}},this.utils.mobileReady=function(){return navigator.userAgent.match(/android|i(os|p(hone|od|ad))/i)?!0:!1},this.utils.closeBanner=function(){var a=document.getElementById("branch-banner");a&&(a.parentNode.removeChild(a),document.body.style.marginTop="0px")},this.api.validateRequest=function(a,b){for(var e in a.params){var f=a.params[e];if(f.required===!0&&("undefined"==typeof b[e]||""===b[e]||null===b[e]))return c.utils.console(d.debugMsgs.missingParam+e),!1;if("jsonObj"==f.type){if(f.required===!0&&"object"!=typeof b[e])return c.utils.console(d.debugMsgs.invalidParam+e),!1;if(f.params)return c.api.validateRequest(a.params[f.ref],b[f.ref])}else if(f.type="jsonArray"){if(f.required===!0&&!b[e]instanceof Array)return c.utils.console(d.debugMsgs.invalidParam+e),!1}else if(!d.formap[f.type].test(b[e]))return c.utils.console(d.debugMsgs.invalidParam+e),!1}return!0},this.api.makeRequest=function(a,b,e,f){if(c.api.validateRequest(a,b)){"function"!=typeof e&&(e=function(a){c.utils.console("Request complete",a)}),"function"!=typeof f&&(f=function(a,b,d){c.utils.console("Request failed",[a,b,d])});var g;g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),g.onreadystatechange=function(){4===g.readyState&&200===g.status?e(JSON.parse(g.responseText)):4===g.readyState&&402===g.status&&e({error:"Not enough credits to redeem."})};var h="";if(a.rest)for(var i=0;i<a.rest.length;i++)a.endpoint=a.endpoint.replace(":"+a.rest[i],b[a.rest[i]]),delete b[a.rest[i]];var j=d.connector.url;if(void 0!==a.api&&a.api===!1)j="";else if("GET"===a.method){h="?";for(var k in b)h+=k+"="+b[k]+"&"}g.open(a.method,j+a.endpoint+h.substring(0,h.length-1),!0),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.setRequestHeader("Branch-Connector",d.connector.name+"/"+d.connector.version),a.ref&&(b=c.utils.mergeMeta(b,b[a.ref]),delete b[a.ref]),g.send(JSON.stringify(b))}},this.init=function(a){if(null===c.utils.readSession()||void 0!==d.linkId){var b=function(a){c.api.makeRequest(d.resources.session.sessionOpen,{app_id:d.appId,identity_id:c.utils.identity(),link_identifier:void 0!==d.linkId?d.linkId:"",is_referrable:1,browser_fingerprint_id:void 0!==window.browser_fingerprint_id?window.browser_fingerprint_id:null},function(b){sessionStorage.setItem("branch_session",JSON.stringify(b)),c.initialized=!0,"function"==typeof a&&a(b)})};c.q.route(function(){b(function(b){c.q.next(),"function"==typeof a&&a(b)})},function(){c.q.chain.push(function(){c.initialized.apply(null,[a])})})}else c.initialized=!0,"function"==typeof a&&a(c.utils.readSession())},this.close=function(a){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);var b=function(a){c.api.makeRequest(d.resources.session.sessionClose,{app_id:d.appId,session_id:c.utils.session()},function(b){sessionStorage.clear(),c.initialized=!1,"function"==typeof a&&a(b)})};c.q.route(function(){b(function(b){c.q.next(),"function"==typeof a&&a(b)})},function(){c.q.chain.push(function(){c.close.apply(null,[a])})})},this.logout=function(a){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);var b=function(a){c.api.makeRequest(d.resources.session.sessionLogout,{app_id:d.appId,session_id:c.utils.session()},function(b){var d=c.utils.readSession();d.session_id=b.session_id,d.identity_id=b.identity_id,d.link=b.link,sessionStorage.setItem("branch_session",JSON.stringify(d)),"function"==typeof a&&a(b)})};c.q.route(function(){b(function(b){c.q.next(),"function"==typeof a&&a(b)})},function(){c.q.chain.push(function(){c.logout.apply(null,[a])})})},this.track=function(a,b,e){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);"function"==typeof b&&(e=b,b={});var f={url:document.URL,user_agent:navigator.userAgent,language:navigator.language};b&&(f=c.utils.mergeMeta(f,b));var g=function(b){c.api.makeRequest(d.resources.events.track,{app_id:d.appId,session_id:c.utils.session(),event:a,metadata:f},function(a){"function"==typeof b&&b(a)})};c.q.route(function(){g(function(a){c.q.next(),e&&e(a)})},function(){c.q.chain.push(function(){c.track.apply(null,[a,b,e])})})},this.identify=function(a,b){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);var e=function(b){c.api.makeRequest(d.resources.session.sessionProfile,{app_id:d.appId,identity_id:c.utils.identity(),obj:a},function(a){var d=c.utils.readSession();d.identity_id=a.identity_id,d.link=a.link,d.referring_data=a.referring_data,d.referring_identity=a.referring_identity,sessionStorage.setItem("branch_session",JSON.stringify(d)),"function"==typeof b&&b(a)})};c.q.route(function(){e(function(a){c.q.next(),b&&b(a)})},function(){c.q.chain.push(function(){c.identify.apply(null,[a,b])})})},this.createLink=function(a,b){return c.initialized?(a.source="web-sdk",void 0!==a.data.$desktop_url&&(a.data.$desktop_url=a.data.$desktop_url.replace(/#r:[a-z0-9-_]+$/i,"")),void c.api.makeRequest(d.resources.links.createLink,{app_id:d.appId,identity:c.utils.identity(),obj:a},function(a){"function"==typeof b&&b(a.url)})):c.utils.console(d.debugMsgs.nonInit)},this.createLinkClick=function(a,b){return c.initialized?void c.api.makeRequest(d.resources.links.createLinkClick,{url:a},function(a){"function"==typeof b&&b(a.click_id)}):c.utils.console(d.debugMsgs.nonInit)},this.SMSLink=function(a,b){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);var e=a.phone;a.channel="sms",void 0===d.linkId?this.createLink(a,function(a){c.api.makeRequest(d.resources.links.createLinkClick,{link_url:a+"?click"},function(a){c.sendSMSLink(e,d.linkUrl+"/c/"+a.click_id,function(){"function"==typeof b&&b()})})}):c.sendSMSLink(e,d.linkUrl+"/c/"+d.linkId,function(){"function"==typeof b&&b()})},this.sendSMSLink=function(a,b,e){c.api.makeRequest(d.resources.links.sendSMSLink,{link_url:b,phone:a},function(a){"function"==typeof e&&e(a)})},this.showReferrals=function(a){return c.initialized?void c.api.makeRequest(d.resources.referrals.showReferrals,{app_id:d.appId,identity_id:c.utils.identity()},function(b){"function"==typeof a&&a(b)}):c.utils.console(d.debugMsgs.nonInit)},this.showCredits=function(a){return c.initialized?void c.api.makeRequest(d.resources.referrals.showCredits,{app_id:d.appId,identity_id:c.utils.identity()},function(b){"function"==typeof a&&a(b)}):c.utils.console(d.debugMsgs.nonInit)},this.redeemCredits=function(a,b){return c.initialized?void c.api.makeRequest(d.resources.referrals.redeemCredits,{app_id:d.appId,identity_id:c.utils.identity(),obj:a},function(a){"function"==typeof b&&b(a)}):c.utils.console(d.debugMsgs.nonInit)},this.appBanner=function(a){if(!c.initialized)return c.utils.console(d.debugMsgs.nonInit);var b=a,e=document.head,f=document.body,g=document.createElement("style"),h=document.createElement("div"),i=document.createElement("div");if(c.utils.mobileReady())c.createLink({channel:"appBanner",data:b.data?b.data:{}},function(a){g.type="text/css",g.innerHTML=["#branch-banner { position: fixed; top: 0px; width: 100%; font-family: Helvetica, Arial, sans-serif; }","#branch-banner .close-x { float: left; font-weight: 200; color: #aaa; font-size: 14px; padding-right: 4px; margin-top: -5px; margin-left: -2px; cursor: pointer; }","#branch-banner .content { position: absolute; width: 100%; height: 71px; z-index: 99999; background: white; color: #444; border-bottom: 1px solid #ddd; }","#branch-banner .content .left { width: 60%; float: left; padding: 5px 0 0 7px; }","#branch-banner .content .left .icon img { width: 60px; height: 60px; margin-right: 6px; }","#branch-banner .content .left .details { margin: 13px 0; }","#branch-banner .content .left .details .title { display: block; font-size: 12px; font-weight: 400; }","#branch-banner .content .left .details .description { display: block; font-size: 10px; font-weight: 200; }","#branch-banner .content .right { width: 40%; float: left; padding: 23px 6px 0 0; text-align: right; }","#branch-banner .content .right a { display: block; float: right; margin-right: 5px; background: #6EBADF; color: white; font-size: 10px; font-weight: 400; padding: 5px 5px 4px; border-radius: 2px; letter-spacing: .08rem; text-transform: uppercase; }","#branch-banner .content .right a:hover { text-decoration: none; }"].join("\n"),e.appendChild(g),f.style.marginTop="71px",i.innerHTML=['<div id="branch-banner">','  <div class="content">','    <div class="left">','      <div class="close-x" onclick="branch.utils.closeBanner();">&times;</div>','      <div class="icon" style="float: left;">','        <img src="'+b.icon+'">',"      </div>",'      <div class="details">','        <span class="title">'+b.title+"</span>",'        <span class="description">'+b.description+"</span>","      </div>","    </div>",'    <div class="right">','      <a href="'+a+'">View in App</a>',"    </div>","  </div>","</div>"].join("\n"),h.appendChild(i),f.appendChild(h)});else{g.innerHTML=["#branch-banner { position: fixed; top: 0px; width: 100%; font-family: Helvetica, Arial, sans-serif; }","#branch-banner .close-x { float: left; font-weight: 200; color: #aaa; font-size: 14px; padding-right: 4px; margin-top: -5px; margin-left: -2px; cursor: pointer; }","#branch-banner .content { position: absolute; width: 100%; height: 71px; z-index: 99999; background: white; color: #444; border-bottom: 1px solid #ddd; }","#branch-banner .content .left { width: 60%; float: left; padding: 5px 0 0 7px; }","#branch-banner .content .left .icon img { width: 60px; height: 60px; margin-right: 6px; }","#branch-banner .content .left .details { margin: 10px 0; }","#branch-banner .content .left .details .title { display: block; font-size: 14px; font-weight: 400; }","#branch-banner .content .left .details .description { display: block; font-size: 12px; font-weight: 200; }","#branch-banner .content .right { width: 40%; float: left; padding: 21px 9px 0 0; text-align: right; }","#branch-banner .content .right input { font-weight: 100; border-radius: 2px; border: 1px solid #bbb; padding: 5px 7px 4px; width: 125px; text-align: center; font-size: 12px; }","#branch-banner .content .right button { margin-top: 0px; display: inline-block; height: 28px; float: right; margin-left: 5px; font-family: Helvetica, Arial, sans-serif; font-weight: 400; border-radius: 2px; border: 1px solid #6EBADF; background: #6EBADF; color: white; font-size: 10px; letter-spacing: .06em; text-transform: uppercase; padding: 0px 12px; }","#branch-banner .content .right button:hover { color: #6EBADF; background: white; }","#branch-banner .content .right input:focus, button:focus { outline: none; }","#branch-banner .content .right input.error { color: red; border-color: red; }","#branch-banner .content .right span { display: inline-block; font-weight: 100; margin: 7px 9px; font-size: 12px; }"].join("\n"),e.appendChild(g),f.style.marginTop="71px",i.innerHTML=['<div id="branch-banner">','  <div class="content">','    <div class="left">','      <div class="close-x" onclick="branch.utils.closeBanner();">&times;</div>','      <div class="icon" style="float: left;">','        <img src="'+a.icon+'">',"      </div>",'      <div class="details">','        <span class="title">'+a.title+"</span>",'        <span class="description">'+a.description+"</span>","      </div>","    </div>",'    <div class="right">','      <div id="branch-sms-block">','        <input type="phone" name="branch-sms-phone" id="branch-sms-phone" placeholder="(999) 999-9999">','        <button id="branch-sms-send">TXT Me The App!</button>',"      </div>","    </div>","  </div>","</div>"].join("\n"),h.appendChild(i),f.appendChild(h);var j=document.getElementById("branch-sms-phone");document.getElementById("branch-sms-send").onclick=function(){j.className="";var a=j.value.replace(/[^0-9.]/g,"");""!==a&&a.length>=5?c.SMSLink({phone:a,data:b.data?b.data:{}},function(){document.getElementById("branch-sms-block").innerHTML='<span class="sms-sent">App link sent to '+a+"!</span>"}):j.className="error"}}},b="undefined"!=typeof b?b:!1;var c=this,d={appId:a,connector:{url:"https://api.branch.io",name:"web-sdk",version:"0.1"},linkUrl:"https://bnc.lt",linkId:c.utils.hashValue("r"),formap:branch_map.formap,resources:branch_map.resources,debugMsgs:branch_map.debugMessages};return void 0===a?(c.utils.console(d.debugMsgs.missingAppId),!1):void(c.q=new c.utils.queue)},q=window.branch.queued;window.branch=new Branch(window.branch.app_id,window.branch.debug,window.branch.callback),branch.init(function(){if(q.length)for(i=0;i<q.length;i++)window.branch[q[i].shift()].apply(window.branch,q[i]);"function"==typeof self.init_callback&&self.init_callback()});