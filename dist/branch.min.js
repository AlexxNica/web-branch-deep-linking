var branch_map={debugMessages:{nonInit:"Branch SDK not initialized",existingInit:"Branch SDK already initilized",missingParam:"Missing required parameter ",invalidParam:"Invalid parameter ",missingAppId:"Missing Branch app ID"},formap:{string:/.*/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,password:/.{6,}/,uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,appId:/^[0-9]{15,20}$/,identityId:/^[0-9]{15,20}$/,sessionId:/^[0-9]{15,20}$/,jsonObj:"object",number:/^\d+$/},resources:{session:{sessionOpen:{endpoint:"/v1/open",method:"POST",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!1},link_identifier:{type:"string",required:!1},is_referrable:{type:"number",required:!0},browser_fingerprint_id:{type:"string",required:!1}}},sessionProfile:{endpoint:"/v1/profile",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!1},obj:{type:"jsonObj",required:!0,ref:"obj",params:{identity:{type:"string",required:!0},set:{type:"jsonObj",required:!1},add:{type:"jsonObj",required:!1},append:{type:"jsonObj",required:!1},union:{type:"jsonObj",required:!1}}}}},sessionClose:{endpoint:"/v1/close",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0}}},sessionLogout:{endpoint:"/v1/logout",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0}}}},referrals:{showReferrals:{endpoint:"/v1/referrals/:identity_id",method:"GET",rest:["identity_id"],params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0}}},showCredits:{endpoint:"/v1/credits/:identity_id",method:"GET",rest:["identity_id"],params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0}}},redeemCredits:{endpoint:"/v1/redeem",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity_id:{type:"identityId",required:!0},obj:{type:"jsonObj",required:!0,ref:"obj",params:{amount:{type:"number",required:!0},bucket:{type:"string",required:!1}}}}}},links:{createLink:{endpoint:"/v1/url",method:"POST",ref:"obj",params:{app_id:{type:"appId",required:!0},identity:{type:"identityId",required:!0},obj:{type:"jsonObj",required:!0,ref:"obj",params:{data:{type:"jsonObj",required:!1},tags:{type:"jsonArray",required:!1},feature:{type:"string",required:!1},channel:{type:"string",required:!1},stage:{type:"string",required:!1},type:{type:"number",required:!1}}}}},createLinkClick:{api:!1,endpoint:":link_url",method:"GET",rest:["link_url"],params:{link_url:{type:"string",required:!0}}},sendSMSLink:{api:!1,endpoint:":link_url",method:"POST",rest:["link_url"],params:{phone:{type:"string",required:!0},link_url:{type:"string",required:!0}}}},events:{track:{endpoint:"/v1/event",method:"POST",params:{app_id:{type:"appId",required:!0},session_id:{type:"sessionId",required:!0},event:{type:"string",required:!0},metadata:{type:"jsonObj",required:!1}}}}}},Branch=function(e,i){"use strict";this.initialized=!1,this.api={},this.utils={},this.utils.console=function(e){return i&&console&&console.error(e),!1},this.utils.readSession=function(){return JSON.parse(sessionStorage.getItem("branch_session"))},this.utils.identity=function(){var e="";return sessionStorage.getItem("branch_session")&&(e=this.readSession().identity_id),e},this.utils.session=function(){var e="";return sessionStorage.getItem("branch_session")&&(e=this.readSession().session_id),e},this.utils.mergeMeta=function(e,i){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);for(t in i)i.hasOwnProperty(t)&&(n[t]=i[t]);return n},this.utils.hashValue=function(e){var i;try{i=location.hash.match(new RegExp(e+":([^&]*)"))[1]}catch(n){i=void 0}return i},this.utils.queue=function(){var e=this;e.free=!0,e.chain=[],e.next=function(){e.chain.length>0?(e.free=!0,e.chain[0].call(),e.chain.shift()):e.free=!0},e.route=function(i,n){e.free?(i(),e.free=!1):n()}},this.utils.mobileReady=function(){return navigator.userAgent.match(/android|i(os|p(hone|od|ad))/i)?!0:!1},this.utils.closeBanner=function(){var e=document.getElementById("branch-banner");e&&(e.parentNode.removeChild(e),document.body.style.marginTop="0px")},this.api.validateRequest=function(e,i){for(var r in e.params)if(e.params.hasOwnProperty(r)){var s=e.params[r];if(s.required===!0&&("undefined"==typeof i[r]||""===i[r]||null===i[r]))return n.utils.console(t.debugMsgs.missingParam+r),!1;if("jsonObj"==s.type){if(s.required===!0&&"object"!=typeof i[r])return n.utils.console(t.debugMsgs.invalidParam+r),!1;if(s.params)return n.api.validateRequest(e.params[s.ref],i[s.ref])}else if("jsonArray"==s.type){if(s.required===!0&&!i[r]instanceof Array)return n.utils.console(t.debugMsgs.invalidParam+r),!1}else if(s.required===!0&&!t.formap[s.type].test(i[r]))return n.utils.console(t.debugMsgs.invalidParam+r),!1}return!0},this.api.makeRequest=function(e,i,r,s){if(n.api.validateRequest(e,i)){"function"!=typeof r&&(r=function(e){n.utils.console("Request complete",e)}),"function"!=typeof s&&(s=function(e,i,t){n.utils.console("Request failed",[e,i,t])});var o;o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4===o.readyState&&200===o.status?r(JSON.parse(o.responseText)):4===o.readyState&&402===o.status&&r({error:"Not enough credits to redeem."})};var a="";if(e.rest)for(var d=0;d<e.rest.length;d++)e.endpoint=e.endpoint.replace(":"+e.rest[d],i[e.rest[d]]),delete i[e.rest[d]];var p=t.connector.url;if(void 0!==e.api&&e.api===!1)p="";else if("GET"===e.method){a="?";for(var c in i)i.hasOwnProperty(c)&&(a+=c+"="+i[c]+"&")}o.open(e.method,p+e.endpoint+a.substring(0,a.length-1),!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Branch-Connector",t.connector.name+"/"+t.connector.version),e.ref&&(i=n.utils.mergeMeta(i,i[e.ref]),delete i[e.ref]),o.send(JSON.stringify(i))}},this.init=function(e){if(null===n.utils.readSession()||void 0!==t.linkId){var i=function(e){n.api.makeRequest(t.resources.session.sessionOpen,{app_id:t.appId,identity_id:n.utils.identity(),link_identifier:void 0!==t.linkId?t.linkId:"",is_referrable:1,browser_fingerprint_id:void 0!==window.browser_fingerprint_id?window.browser_fingerprint_id:null},function(i){sessionStorage.setItem("branch_session",JSON.stringify(i)),n.initialized=!0,"function"==typeof e&&e(i)})};n.q.route(function(){i(function(i){n.q.next(),"function"==typeof e&&e(i)})},function(){n.q.chain.push(function(){n.initialized.apply(null,[e])})})}else n.initialized=!0,"function"==typeof e&&e(n.utils.readSession())},this.close=function(e){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);var i=function(e){n.api.makeRequest(t.resources.session.sessionClose,{app_id:t.appId,session_id:n.utils.session()},function(i){sessionStorage.clear(),n.initialized=!1,"function"==typeof e&&e(i)})};n.q.route(function(){i(function(i){n.q.next(),"function"==typeof e&&e(i)})},function(){n.q.chain.push(function(){n.close.apply(null,[e])})})},this.logout=function(e){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);var i=function(e){n.api.makeRequest(t.resources.session.sessionLogout,{app_id:t.appId,session_id:n.utils.session()},function(i){var t=n.utils.readSession();t.session_id=i.session_id,t.identity_id=i.identity_id,t.link=i.link,sessionStorage.setItem("branch_session",JSON.stringify(t)),"function"==typeof e&&e(i)})};n.q.route(function(){i(function(i){n.q.next(),"function"==typeof e&&e(i)})},function(){n.q.chain.push(function(){n.logout.apply(null,[e])})})},this.track=function(e,i,r){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);"function"==typeof i&&(r=i,i={});var s={url:document.URL,user_agent:navigator.userAgent,language:navigator.language};i&&(s=n.utils.mergeMeta(s,i));var o=function(i){n.api.makeRequest(t.resources.events.track,{app_id:t.appId,session_id:n.utils.session(),event:e,metadata:s},function(e){"function"==typeof i&&i(e)})};n.q.route(function(){o(function(e){n.q.next(),r&&r(e)})},function(){n.q.chain.push(function(){n.track.apply(null,[e,i,r])})})},this.identify=function(e,i){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);var r=function(i){n.api.makeRequest(t.resources.session.sessionProfile,{app_id:t.appId,identity_id:n.utils.identity(),obj:e},function(e){var t=n.utils.readSession();t.identity_id=e.identity_id,t.link=e.link,t.referring_data=e.referring_data,t.referring_identity=e.referring_identity,sessionStorage.setItem("branch_session",JSON.stringify(t)),"function"==typeof i&&i(e)})};n.q.route(function(){r(function(e){n.q.next(),i&&i(e)})},function(){n.q.chain.push(function(){n.identify.apply(null,[e,i])})})},this.createLink=function(e,i){return n.initialized?(e.source="web-sdk",void 0!==e.data.$desktop_url&&(e.data.$desktop_url=e.data.$desktop_url.replace(/#r:[a-z0-9-_]+$/i,"")),void n.api.makeRequest(t.resources.links.createLink,{app_id:t.appId,identity:n.utils.identity(),obj:e},function(e){"function"==typeof i&&i(e.url)})):n.utils.console(t.debugMsgs.nonInit)},this.createLinkClick=function(e,i){return n.initialized?void n.api.makeRequest(t.resources.links.createLinkClick,{url:e},function(e){"function"==typeof i&&i(e.click_id)}):n.utils.console(t.debugMsgs.nonInit)},this.SMSLink=function(e,i){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);var r=e.phone;e.channel="sms",void 0===t.linkId?this.createLink(e,function(e){n.api.makeRequest(t.resources.links.createLinkClick,{link_url:e.replace(/^http:\/\/[^\/]+/,"https://bnc.lt")+"?click"},function(e){n.sendSMSLink(r,t.linkUrl+"/c/"+e.click_id,function(){"function"==typeof i&&i()})})}):n.sendSMSLink(r,t.linkUrl+"/c/"+t.linkId,function(){"function"==typeof i&&i()})},this.sendSMSLink=function(e,i,r){n.api.makeRequest(t.resources.links.sendSMSLink,{link_url:i.replace(/^http:\/\/[^\/]+/,"https://bnc.lt"),phone:e},function(e){"function"==typeof r&&r(e)})},this.showReferrals=function(e){return n.initialized?void n.api.makeRequest(t.resources.referrals.showReferrals,{app_id:t.appId,identity_id:n.utils.identity()},function(i){"function"==typeof e&&e(i)}):n.utils.console(t.debugMsgs.nonInit)},this.showCredits=function(e){return n.initialized?void n.api.makeRequest(t.resources.referrals.showCredits,{app_id:t.appId,identity_id:n.utils.identity()},function(i){"function"==typeof e&&e(i)}):n.utils.console(t.debugMsgs.nonInit)},this.redeemCredits=function(e,i){return n.initialized?void n.api.makeRequest(t.resources.referrals.redeemCredits,{app_id:t.appId,identity_id:n.utils.identity(),obj:e},function(e){"function"==typeof i&&i(e)}):n.utils.console(t.debugMsgs.nonInit)},this.appBanner=function(e){if(!n.initialized)return n.utils.console(t.debugMsgs.nonInit);var i=e,r=document.head,s=document.body,o=document.createElement("style"),a=document.createElement("div"),d=document.createElement("div");if(n.utils.mobileReady())n.createLink({channel:"appBanner",data:i.data?i.data:{}},function(e){o.type="text/css",o.innerHTML="#branch-banner { position: fixed; top: 0px; width: 100%; font-family: Helvetica, Arial, sans-serif; }#branch-banner .close-x { float: left; font-weight: 200; color: #aaa; font-size: 14px; padding-right: 4px; margin-top: -5px; margin-left: -2px; cursor: pointer; }#branch-banner .content { position: absolute; width: 100%; height: 71px; z-index: 99999; background: white; color: #444; border-bottom: 1px solid #ddd; }#branch-banner .content .left { width: 60%; float: left; padding: 5px 0 0 7px; }#branch-banner .content .left .icon img { width: 60px; height: 60px; margin-right: 6px; }#branch-banner .content .left .details { margin: 13px 0; }#branch-banner .content .left .details .title { display: block; font-size: 12px; font-weight: 400; }#branch-banner .content .left .details .description { display: block; font-size: 10px; font-weight: 200; }#branch-banner .content .right { width: 40%; float: left; padding: 23px 6px 0 0; text-align: right; }#branch-banner .content .right a { display: block; float: right; margin-right: 5px; background: #6EBADF; color: white; font-size: 10px; font-weight: 400; padding: 5px 5px 4px; border-radius: 2px; letter-spacing: .08rem; text-transform: uppercase; }#branch-banner .content .right a:hover { text-decoration: none; }",r.appendChild(o),s.style.marginTop="71px",d.innerHTML='<div id="branch-banner"><div class="content"><div class="left"><div class="close-x" onclick="branch.utils.closeBanner();">&times;</div><div class="icon" style="float: left;"><img src="'+i.icon+'"></div><div class="details"><span class="title">'+i.title+'</span><span class="description">'+i.description+'</span></div></div><div class="right"><a href="'+e+'">View in App</a></div></div></div>',a.appendChild(d),s.appendChild(a)});else{o.innerHTML="#branch-banner { position: fixed; top: 0px; width: 100%; font-family: Helvetica, Arial, sans-serif; }#branch-banner .close-x { float: left; font-weight: 200; color: #aaa; font-size: 14px; padding-right: 4px; margin-top: -5px; margin-left: -2px; cursor: pointer; }#branch-banner .content { position: absolute; width: 100%; height: 71px; z-index: 99999; background: white; color: #444; border-bottom: 1px solid #ddd; }#branch-banner .content .left { width: 60%; float: left; padding: 5px 0 0 7px; }#branch-banner .content .left .icon img { width: 60px; height: 60px; margin-right: 6px; }#branch-banner .content .left .details { margin: 10px 0; }#branch-banner .content .left .details .title { display: block; font-size: 14px; font-weight: 400; }#branch-banner .content .left .details .description { display: block; font-size: 12px; font-weight: 200; }#branch-banner .content .right { width: 40%; float: left; padding: 21px 9px 0 0; text-align: right; }#branch-banner .content .right input { font-weight: 100; border-radius: 2px; border: 1px solid #bbb; padding: 5px 7px 4px; width: 125px; text-align: center; font-size: 12px; }#branch-banner .content .right button { margin-top: 0px; display: inline-block; height: 28px; float: right; margin-left: 5px; font-family: Helvetica, Arial, sans-serif; font-weight: 400; border-radius: 2px; border: 1px solid #6EBADF; background: #6EBADF; color: white; font-size: 10px; letter-spacing: .06em; text-transform: uppercase; padding: 0px 12px; }#branch-banner .content .right button:hover { color: #6EBADF; background: white; }#branch-banner .content .right input:focus, button:focus { outline: none; }#branch-banner .content .right input.error { color: red; border-color: red; }#branch-banner .content .right span { display: inline-block; font-weight: 100; margin: 7px 9px; font-size: 12px; }",r.appendChild(o),s.style.marginTop="71px",d.innerHTML='<div id="branch-banner"><div class="content"><div class="left"><div class="close-x" onclick="branch.utils.closeBanner();">&times;</div><div class="icon" style="float: left;"><img src="'+e.icon+'"></div><div class="details"><span class="title">'+e.title+'</span><span class="description">'+e.description+'</span></div></div><div class="right"><div id="branch-sms-block"><input type="phone" name="branch-sms-phone" id="branch-sms-phone" placeholder="(999) 999-9999"><button id="branch-sms-send">TXT Me The App!</button></div></div></div></div>',a.appendChild(d),s.appendChild(a);var p=document.getElementById("branch-sms-phone");document.getElementById("branch-sms-send").onclick=function(){p.className="";var e=p.value.replace(/[^0-9.]/g,"");""!==e&&e.length>=5?n.SMSLink({phone:e,data:i.data?i.data:{}},function(){document.getElementById("branch-sms-block").innerHTML='<span class="sms-sent">App link sent to '+e+"!</span>"}):p.className="error"}}},i="undefined"!=typeof i?i:!1;var n=this,t={appId:e,connector:{url:"https://api.branch.io",name:"web-sdk",version:"0.1"},linkUrl:"https://bnc.lt",linkId:n.utils.hashValue("r"),formap:branch_map.formap,resources:branch_map.resources,debugMsgs:branch_map.debugMessages};return void 0===e?(n.utils.console(t.debugMsgs.missingAppId),!1):void(n.q=new n.utils.queue)},q=window.branch.queued;window.branch=new Branch(window.branch.app_id,window.branch.debug,window.branch.callback),branch.init(function(){if(q.length)for(var e=0;e<q.length;e++)window.branch[q[e].shift()].apply(window.branch,q[e]);"function"==typeof self.init_callback&&self.init_callback()});